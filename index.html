<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calculador de Precios - DINÁMICA AXM</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #0d1b2a; color: white; }
    header { background-color: #1b263b; padding: 15px; text-align: center; }
    header img { height: 60px; vertical-align: middle; }
    header h1 { display: inline; margin-left: 10px; font-size: 1.5em; color: #00b4d8; }
    #map { height: 300px; }
    .container { padding: 15px; }
    label { display: block; margin-top: 10px; }
    input, select { width: 100%; padding: 8px; margin-top: 5px; border: none; border-radius: 5px; }
    .result { margin-top: 15px; background: #1b263b; padding: 10px; border-radius: 5px; position: relative; }
    .loader { border: 4px solid #f3f3f3; border-top: 4px solid #00b4d8; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display: inline-block; vertical-align: middle; }
    @keyframes spin { 100% { transform: rotate(360deg); } }
    .check { color: #00ff88; font-size: 20px; display: inline-block; vertical-align: middle; }
</style>
</head>
<body>

<header>
    <img src="https://upload.wikimedia.org/wikipedia/commons/4/4a/Logo_2013_Google.png" alt="Logo">
    <h1>DINÁMICA AXM - Calculador de Precios</h1>
</header>

<div id="map"></div>

<div class="container">
    <label>Sector:</label>
    <select id="sector">
        <option value="sur">Sur</option>
        <option value="norte">Norte</option>
    </select>

    <label>Dirección de recogida:</label>
    <input type="text" id="start" placeholder="Ej: Calle 10 #15-20, Armenia Quindío">

    <label>Dirección de entrega:</label>
    <input type="text" id="end" placeholder="Ej: Carrera 14 #8-30, Armenia Quindío">

    <div class="result">
        <p>Distancia: <span id="distance">0</span> km <span id="status"></span></p>
        <p>Total: <span id="price">$0</span> COP</p>
    </div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
    let map = L.map('map').setView([4.5345, -75.6811], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);

    let startMarker, endMarker;

    async function geocode(address) {
        let url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}, Armenia, Quindío, Colombia`;
        let res = await fetch(url);
        let data = await res.json();
        return data.length > 0 ? [parseFloat(data[0].lat), parseFloat(data[0].lon)] : null;
    }

    function calcularPrecio(sector, distancia) {
        distancia = parseFloat(distancia);
        if (sector === "sur") {
            if (distancia <= 4) return 5000;
            if (distancia <= 6) return 6000;
            if (distancia <= 7) return 7000;
            return 8000;
        } else { // norte
            if (distancia <= 2) return 5000;
            if (distancia <= 4) return 6000;
            if (distancia <= 6) return 7000;
            return 8000;
        }
    }

    async function calculateRoute() {
        let startAddress = document.getElementById('start').value;
        let endAddress = document.getElementById('end').value;
        let sector = document.getElementById('sector').value;

        if (!startAddress || !endAddress) return;

        document.getElementById('status').innerHTML = '<span class="loader"></span>';

        let startCoords = await geocode(startAddress);
        let endCoords = await geocode(endAddress);

        if (!startCoords || !endCoords) {
            document.getElementById('status').innerHTML = '';
            return;
        }

        let routeUrl = `https://router.project-osrm.org/route/v1/driving/${startCoords[1]},${startCoords[0]};${endCoords[1]},${endCoords[0]}?overview=false`;
        let res = await fetch(routeUrl);
        let data = await res.json();

        if (data.routes && data.routes.length > 0) {
            let distanceKm = (data.routes[0].distance / 1000).toFixed(2);
            let price = calcularPrecio(sector, distanceKm);

            document.getElementById('distance').textContent = distanceKm;
            document.getElementById('price').textContent = `$${price.toLocaleString('es-CO')}`;
            document.getElementById('status').innerHTML = '<span class="check">✔</span>';

            if (startMarker) map.removeLayer(startMarker);
            if (endMarker) map.removeLayer(endMarker);

            startMarker = L.marker(startCoords).addTo(map).bindPopup("Recogida");
            endMarker = L.marker(endCoords).addTo(map).bindPopup("Entrega");
            map.fitBounds([startCoords, endCoords]);
        }
    }

    document.getElementById('start').addEventListener('change', calculateRoute);
    document.getElementById('end').addEventListener('change', calculateRoute);
    document.getElementById('sector').addEventListener('change', calculateRoute);
</script>

</body>
</html>
